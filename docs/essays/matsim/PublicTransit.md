### MATSim中构建公交系统

MATSim公交模块从初始的teleportation模式演进到基于QSIM的模式。目前支持及其精细化的公交建模。包括车辆在指定的路线上运行，在对应站点的上下客行为，以及车辆的最大载客量和速度限制。
公交建模需要的数据主要包含三大类：1、物理站点位置；2、线路、路由、时刻表和出发时间信息；3、车辆信息（每一种车辆类型都对应了最大座位数和最大站立乘客数，以及可以包含每秒可以允许的上/下客人数）；
在MATSim工程文件中，公交数据主要保存在两个文件夹下。其中一个文件夹用于保存定义车辆信息的文件（3），另一个文件夹保存定义站点和线路等信息的文件（1和2）
和EMME等商业软件中对公交线路的定义相同，MATSim中的公交线路通常也拆分为上行和下行两条独立的路线，如果存在特殊的短线则性需要单独使用额外的线路进行定义；每一条公交线路的路由都包含了该线路途径哪些link，服务哪些站点，同时包含了从起始站点出发的时间，以及后续到达和离开每个站点的时间，这些时间以相对时间差的形式记录在文件内。（鉴于此，MATSim的公交当要考虑拥堵时段包含的延误时，可以直接通过更改时刻表的形式来等效表征？）
最新的pt模块已经支持非常先进的公交建模方式，包含在一天中的不同时间采用不同的线路运行速度（提升仿真真实度）；在不同时段使用不同的车辆类型（用作运营经济分析）；以及在一条或多条线路中应用不用的发车间隔（用于时刻表优化或者延误传播的相关分析）。
在公交线路中，除了最后一个站点外，每个站点都必须包含一个离开时间。但到达时间是可选的，一般铁路站点推荐预先指定好到达时间指，这样路径求解器会根据真实的停站时间规划可能的轨道换乘方式。

常见的时刻表数据只包含了站点和相关运营信息，但不会包含线路经过了哪些link，MATSim中的org.matsim.utils.pt.CreatePseudoNetwork模块可以创建一套基于直线链接的虚拟公交网，PT2MATSim模块可以尝试将在这部公交网络和底图融合，融合之后的路网尽管会保留一定的人工痕迹，但网络整体可视化效果能明显提升。

![pseudo pt network](https://raw.githubusercontent.com/RGB3Q/imgbed/master/1660617231141-b51dbe41-3ab8-41b2-8b61-e734474df06d.png "pseudo pt network")

![mapped pt network](https://raw.githubusercontent.com/RGB3Q/imgbed/master/1660617243679-ea3d50f3-29de-4542-a0d4-84b48a07f955.png "mapped pt network")



